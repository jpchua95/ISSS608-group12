---
title: "Confirmatory Data Analysis (CDA)"
author: "Jia Peng Chua | Zanelle Lee Wenfang"
date-modified: "last-modified"
execute:
    echo: true
    eval: true
    warning: false
    freeze: true
---

# 1. Getting Started

## 1.1 Loading R Packages

```{r}
#| code-fold: true
#| code-summary: "Loading R packages"
pacman::p_load(tidyverse, plotly, sf, tmap, GGally, ggstatsplot, ggmosaic)
```

## 1.2 Importing Dengue Dataset

```{r}
#| code-fold: true
#| code-summary: "Importing Dengue_Daily dataset"
dengue_daily <- read_csv("data/dengue_daily_en.csv")

summary(dengue_daily)
```

# 2. Confirmatory Data Analysis (CDA)

## 2.1 Does certain age group have significantly higher dengue cases compared to others?

First, let's visualise the distribution of mean dengue cases by age groups.

```{r}
#| code-fold: true
#| code-summary: "Show code"

mean_age_group_year <- dengue_daily %>%
    group_by(Age_Group, Onset_Year) %>%
    summarize(Mean = mean(n()), .groups = "drop")

ggplot(mean_age_group_year, aes(x = Age_Group, y = Mean, fill = Age_Group)) +
    geom_boxplot() +
    labs(title = "Distribution of Dengue Cases Across Age Groups",
         x = "Age Group",
         y = "Mean Dengue Cases per Year")
```

### 2.1.1 Check if dengue cases are evenly distributed across age groups

We perform chi-square test using the sum of dengue cases by age group.

-   H~0~: The number of dengue cases is independent of age group

-   H~1~: The number of dengue cases depends on age group

::: panel-tabset
#### Chi-Square test

```{r}
#| code-fold: true
#| code-summary: "Show code"
sum_age_group <- dengue_daily %>%
    group_by(Age_Group) %>%
    summarize(Count = n(), .groups = "drop")

chisq.test(sum_age_group$Count)
```

#### Visual

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggbetweenstats(
    data = sum_age_group,
    x = Age_Group, 
    y = Count,
    type = "np",
    mean.ci = TRUE, 
    p.adjust.method = "fdr",
    messages = FALSE
    )
```
:::

Conclusion:

-   Since p-value is \< 0.05, we reject the null hypothesis at 5% significance level.

-   This suggests that the number of dengue cases varies significantly across different age groups.

### 2.1.2 Check if dengue cases are evenly distributed across age groups over the years

We perform chi-square test using the sum of dengue cases by age group.

-   H~0~: The distribution of dengue cases across age group does not change over the years

-   H~1~: The distribution of dengue cases across age group changes over the years

::: panel-tabset
#### Chi-square test

```{r}
#| code-fold: true
#| code-summary: "Show code"
sum_age_group_year <- dengue_daily %>%
    group_by(Age_Group, Onset_Year) %>%
    summarize(Count = n(), .groups = "drop")

sum_age_group_year_table <- table(sum_age_group_year$Age_Group, 
                                  sum_age_group_year$Onset_Year)

chisq.test(sum_age_group_year_table)
```

#### Visual

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggbetweenstats(
    data = sum_age_group_year,
    x = Age_Group, 
    y = Count,
    type = "p",
    mean.ci = TRUE, 
    pairwise.comparisons = TRUE, 
    pairwise.display = "s",
    p.adjust.method = "fdr",
    messages = FALSE
    )
```
:::

Conclusion:

-   Since p-value is \> 0.05, we do not reject the null hypothesis at 5% significance level.

-   This suggests that the number of dengue cases does not change across different age groups over the years.

### 2.1.3 Check if the average number of dengue cases differs by age group

We perform Kruskal-Wallis test using the mean of dengue cases by age group.

-   H~0~: The mean number of dengue cases per year is the same across all age groups

-   H~1~: The mean number of dengue cases per year is the differs across all age groups

::: panel-tabset
#### Kruskal-Wallis test

```{r}
#| code-fold: true
#| code-summary: "Show code"

group_by_age <- dengue_daily %>%
    group_by(Age_Group, Onset_Year) %>%
    summarize(Count = n(), .groups = "drop")

kruskal.test(Count ~ Age_Group, data = group_by_age)
```

#### Visual

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggbetweenstats(
    data = group_by_age,
    x = Age_Group, 
    y = Count,
    type = "p",
    mean.ci = TRUE, 
    pairwise.comparisons = TRUE, 
    pairwise.display = "s",
    p.adjust.method = "fdr",
    messages = FALSE
    )
```
:::

Conclusion:

-   Since p-value is \< 0.05, we reject the null hypothesis at 5% significance level.

-   This suggests that the mean number of dengue cases differs across different age groups.

## 2.2 How do other factors such as gender, imported cases, serotype and geographic distribution influence the number of dengue cases?

### 2.2.1 Gender

-   H~0~: There is no difference in the number of dengue cases between male and female

-   H~1~: There is a difference in the number of dengue cases between male and female

::: panel-tabset
#### T-test

```{r}
#| code-fold: true
#| code-summary: "Show code"

group_by_gender <- dengue_daily %>%
    group_by(Gender, Onset_Year) %>%
    summarize(Count = n(), .groups = "drop")

group_by_gender_test <- group_by_gender %>%
    filter(Gender %in% c("F", "M"))

t_test_gender <- t.test(Count ~ Gender, data = group_by_gender_test)

t_test_gender
```

#### Two-sample mean test

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggbetweenstats(
    data = group_by_gender_test,
    x = Gender, 
    y = Count,
    type = "np",
    messages = FALSE
    )
```
:::

Conclusion:

-   Since p-value is \> 0.05, we do not reject the null hypothesis at 5% significance level.

-   This suggests that there is no difference in the number of dengue cases between male and female.

### 2.2.2 Imported Cases

-   H~0~: There is no difference in the number of dengue cases between imported and local cases

-   H~1~: There is a difference in the number of dengue cases between imported and local cases

::: panel-tabset
#### T-test

```{r}
#| code-fold: true
#| code-summary: "Show code"

group_by_imported <- dengue_daily %>%
    group_by(Imported_Case, Onset_Year) %>%
    summarize(Count = n(), .groups = "drop")

t_test_gender <- t.test(Count ~ Imported_Case, data = group_by_imported)

t_test_gender
```

#### Two-sample mean test

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggbetweenstats(
    data = group_by_imported,
    x = Imported_Case, 
    y = Count,
    type = "np",
    messages = FALSE
    )
```
:::

Conclusion:

-   Since p-value is < 0.10, we reject the null hypothesis at 10% significance level.

-   This suggests that there is significant difference in the number of dengue cases between imported and local cases.

### 2.2.3 Serotype

-   H~0~: There is no difference in the number of dengue cases between different serotypes

-   H~1~: There is a difference in the number of dengue cases between different serotypes

::: panel-tabset
#### One-way ANOVA test

```{r}
#| code-fold: true
#| code-summary: "Show code"

group_by_serotype <- dengue_daily %>%
    group_by(Serotype, Onset_Year) %>%
    summarize(Count = n(), .groups = "drop")

# Excluding data with missing Serotype
group_by_serotype_test <- group_by_serotype %>% filter(!is.na(Serotype))

anova_serotype <- aov(Count ~ Serotype, data = group_by_serotype_test)

summary(anova_serotype)
```

#### Visual

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggbetweenstats(
    data = group_by_serotype_test,
    x = Serotype, 
    y = Count,
    type = "p",
    mean.ci = TRUE, 
    pairwise.comparisons = TRUE, 
    pairwise.display = "s",
    p.adjust.method = "fdr",
    messages = FALSE
)
```
:::

Conclusion:

-   Since p-value is \> 0.05, we do not reject the null hypothesis at 5% significance level.

-   This suggests that there is no difference in the number of dengue cases between different serotypes.

### 2.2.4 Geographic Distribution

-   H~0~: There is no difference in the number of dengue cases between county cities

-   H~1~: There is a difference in the number of dengue cases between county cities

::: panel-tabset
#### One-way ANOVA test

```{r}
#| code-fold: true
#| code-summary: "Show code"

group_by_county <- dengue_daily %>%
    group_by(Residential_County_City, Onset_Year) %>%
    summarize(Count = n(), .groups = "drop")

kruskal.test(Count ~ Residential_County_City, data = group_by_county)
```

#### Visual

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggbetweenstats(
    data = group_by_county,
    x = Residential_County_City, 
    y = Count,
    type = "p",
    mean.ci = TRUE, 
    pairwise.comparisons = TRUE, 
    pairwise.display = "s",
    p.adjust.method = "fdr",
    messages = FALSE
)
```
:::

Conclusion:

-   Since p-value is \< 0.05, we reject the null hypothesis at 5% significance level.

-   This suggests that there is significant difference in the number of dengue cases between county cities.
